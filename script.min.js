d3.json("assets/data.json").then(function(t){var e=d3.timeParse("%m/%d/%y %I:%M");d3.transition().duration(750).ease(d3.easeLinear);let a="weekly";t.hourly.forEach(t=>{t.date=e(t.Date)}),t.weekly.forEach(t=>{t.date=e(t.Date)}),t.daily.forEach(t=>{t.date=e(t.Date)}),console.log(t);let l=d3.min(t[a],t=>t.Distance),s=d3.max(t[a],t=>t.Distance),i=d3.min(t[a],t=>t.Count),n=d3.max(t[a],t=>t.Count),d=d3.min(t[a],t=>t.date),r=d3.max(t[a],t=>t.date);const c=document.getElementById("start-date"),o=document.getElementById("end-date");c.addEventListener("change",function(){let t=u(d=new Date(this.value),r),e=t[4];l=t[0],s=t[1],i=t[2],n=t[3],d3.select("path#distance-line").datum(e),d3.select("path#trips-line").datum(e),v()}),o.addEventListener("change",function(){r=new Date(this.value);let t=u(d,r),e=t[4];l=t[0],s=t[1],i=t[2],n=t[3],d3.select("path#distance-line").datum(e),d3.select("path#trips-line").datum(e),v()});var h=d3.sliderBottom().min(d).max(r).tickFormat(d3.timeFormat("%m/%d/%y")).default([d3.min(t[a],t=>t.date),d3.max(t[a],t=>t.date)]).fill("#008BBF").on("onchange",t=>{!function(t){d=new Date(t[0]),r=new Date(t[1]);let e=u(d,r),a=e[4];l=e[0],s=e[1],i=e[2],n=e[3],d3.select("path#distance-line").datum(a),d3.select("path#trips-line").datum(a),y(),g(),p(a),v()}(t)});function p(t){d3.select("g#dist-hover-g").selectAll("rect").data(t).enter().append("rect").attr("class","dist-hover-rect hover-rect"),d3.select("g#trips-hover-g").selectAll("rect").data(t).enter().append("rect").attr("class","trips-hover-rect hover-rect")}function g(){d3.selectAll("rect.hover-rect").remove()}function v(){let t=d3.select("#distance").node().getBoundingClientRect();screen.width>800?(baseHeight=650,h.width(250).ticks(2)):(baseHeight=.3*screen.height,h.width(.29*screen.width).ticks(0),d3.select("div#slider").select("svg").attr("width",.5*screen.width));let e=20,a=0,c=80,o=20,p=baseHeight-e-o,g=t.width-a-c;d3.select("#distance-svg").attr("width",g+a+c).attr("height",p+e+o),d3.select("#distance-g").attr("transform","translate("+a+","+e+")"),d3.select("#trips-svg").attr("width",g+a+c).attr("height",p+e+o),d3.select("#trips-g").attr("transform","translate("+a+","+e+")");let v=d3.scaleLinear().domain([l,s]).range([p,0]),m=d3.scaleLinear().domain([i,n]).range([p,0]),u=d3.scaleLinear().domain([d,r]).range([0,g]),y=d3.line().x(t=>u(t.date)).y(t=>m(t.Count)).curve(d3.curveStep),f=d3.line().x(t=>u(t.date)).y(t=>v(t.Distance)).curve(d3.curveStep),x=(d3.select("#distance").select("svg").selectAll("path"),d3.axisBottom(u).ticks(2).tickFormat(d3.timeFormat("%m/%d/%y"))),w=d3.axisRight(v).tickFormat(d3.format(".2s")).tickSize(-g),D=d3.axisRight(m).tickSize(-g);function A(){let t=d3.select(this).attr("x"),e=d3.select("#tooltip"),a="",l=d3.select("path#trips-line").datum();for(let s=0;s<l.length;s++)if(l[s].date>=new Date(u.invert(t))){d3.select("circle#trips-hover-circle").attr("cx",u(l[s].date)).attr("cy",m(l[s].Count)),d3.select("circle#dist-hover-circle").attr("cx",u(l[s].date)).attr("cy",v(l[s].Distance)),a+="<h1>"+l[s].Date+"</h1>",a+="<table><tr><th>Trips</th><th>Distance (mi.)</th></tr>",a+="<tr><td>"+d3.format(",")(l[s].Count)+"</td><td>"+d3.format(".2s")(l[s].Distance)+"</td></tr></table>",e.html(a);break}let s=d3.select("#container").node().getBoundingClientRect(),i=.5*(s.right-s.left),n=.5*(s.bottom-s.top),d=0,r=0;if(d3.event.layerX/(s.right-s.left)>.4&&d3.event.layerX/(s.right-s.left)<.65){let t=e.node().getBoundingClientRect().width;d+=d3.event.layerX-t/2}else if(d3.event.layerX>i){let t=e.node().getBoundingClientRect().width;d+=d3.event.layerX+14-t}else d+=d3.event.layerX+14;if(d3.event.layerY>n){let t=e.node().getBoundingClientRect().height;r+=d3.event.layerY-24-t}else r+=d3.event.layerY+24;e.style("left",d+"px").style("top",r+"px")}d3.select("path#distance-line").transition(750).attr("d",f),d3.select("path#trips-line").transition(750).attr("d",y),d3.select("#trips-svg").select("g.x-axis").attr("transform","translate(0,"+p+")").call(x).select(".domain").remove(),d3.select("#distance-svg").select("g.x-axis").attr("transform","translate(0,"+p+")").call(x).select(".domain").remove(),d3.select("#trips-svg").select("g.y-axis").attr("transform","translate("+g+",0)").call(D).select(".domain").remove(),d3.select("#distance-svg").select("g.y-axis").attr("transform","translate("+g+",0)").call(w).select(".domain").remove(),d3.selectAll("circle.hover-circle").attr("r",6),d3.selectAll("rect.trips-hover-rect").attr("x",(t,e)=>g/d3.select("path#trips-line").datum().length*e).attr("y",0).attr("width",g/d3.select("path#trips-line").datum().length).attr("height",p).on("mouseenter",function(){d3.select("#tooltip").style("display","inline"),d3.selectAll(".hover-circle").style("display","inline")}).on("mouseleave",function(){d3.select("#tooltip").style("display","none"),d3.selectAll(".hover-circle").style("display","none")}).on("mousemove",A).on("touchmove",A),d3.selectAll("rect.dist-hover-rect").attr("x",(t,e)=>g/d3.select("path#distance-line").datum().length*e).attr("y",0).attr("width",g/d3.select("path#distance-line").datum().length).attr("height",p).on("mouseenter",function(){d3.select("#tooltip").style("display","inline"),d3.selectAll(".hover-circle").style("display","inline")}).on("mouseleave",function(){d3.select("#tooltip").style("display","none"),d3.selectAll(".hover-circle").style("display","none")}).on("mousemove",A)}function m(){d3.selectAll("button.granularity").classed("active",!1),d3.select(this).classed("active",!0);let t=d3.select(this).attr("id");a=t;let e=u(d,r),c=e[4];l=e[0],s=e[1],i=e[2],n=e[3],d3.select("path#distance-line").datum(c),d3.select("path#trips-line").datum(c),g(),p(c),v()}function u(e,l){let s=[];return t[a].forEach(t=>{t.date<=l&&t.date>=e?s.push(t):s.push()}),[d3.min(s,t=>t.Distance),d3.max(s,t=>t.Distance),d3.min(s,t=>t.Count),d3.max(s,t=>t.Count),s]}function y(){var t=("0"+new Date(h.value()[0]).getDate()).slice(-2),e=("0"+(new Date(h.value()[0]).getMonth()+1)).slice(-2),a=("0"+new Date(h.value()[1]).getDate()).slice(-2),l=("0"+(new Date(h.value()[1]).getMonth()+1)).slice(-2);c.value=new Date(h.value()[0]).getFullYear()+"-"+e+"-"+t,o.value=new Date(h.value()[1]).getFullYear()+"-"+l+"-"+a}(function(){const e=d3.select("#distance").append("svg").attr("id","distance-svg").append("g").attr("id","distance-g");e.append("g").attr("class","x-axis"),e.append("g").attr("class","y-axis"),e.append("path").attr("id","distance-line").attr("class","line").datum(t[a]),e.append("g").attr("id","dist-hover-g").attr("class","hover-g").append("circle").attr("class","hover-circle").attr("id","dist-hover-circle");const l=d3.select("#trips").append("svg").attr("id","trips-svg").append("g").attr("id","trips-g");l.append("g").attr("class","x-axis"),l.append("g").attr("class","y-axis"),l.append("path").attr("id","trips-line").attr("class","line").datum(t[a]),l.append("g").attr("id","trips-hover-g").attr("class","hover-g").append("circle").attr("class","hover-circle").attr("id","trips-hover-circle"),p(t[a])})(),v(),y(),d3.select("div#slider").append("svg").attr("id","#slider-svg").attr("width",300).attr("height",75).append("g").attr("transform","translate(30,30)").call(h),d3.selectAll("button").on("click",m),window.addEventListener("resize",v)}).catch(function(t){console.log(t)});